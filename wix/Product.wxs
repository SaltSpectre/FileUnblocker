<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">

  <Package Name="SaltSpectre File Unblocker"
           Version="$(var.VERSION)"
           Manufacturer="SaltSpectre"
           Language="1033"
           Compressed="true"
           InstallerVersion="500"
           Scope="perUserOrMachine"
           UpgradeCode="{A1B2C3D4-E5F6-7890-ABCD-EF1234567890}">

    <SummaryInformation Description="Windows utility that removes Zone.Identifier streams to unblock files"
                       Comments="Built with Rust for security and performance" />

    <MajorUpgrade DowngradeErrorMessage="A newer version is already installed."
                  AllowSameVersionUpgrades="true" />

    <MediaTemplate EmbedCab="true" />

    <Property Id="WINDOWSBUILD" Secure="yes">
        <RegistrySearch Id="BuildSearch" Root="HKLM" 
                        Key="SOFTWARE\Microsoft\Windows NT\CurrentVersion" 
                        Name="CurrentBuildNumber" Type="raw" />
    </Property>

    <Launch Condition="Installed OR (WINDOWSBUILD >= 10240)" 
            Message="This application requires Windows 10 (build 10240) or later." />

    <Feature Id="MainFeature"
             Title="File Unblocker Application"
             Description="Core executable"
             Level="1"
             ConfigurableDirectory="INSTALLFOLDER">
      <ComponentGroupRef Id="ApplicationFiles" />
    </Feature>

    <Feature Id="ExplorerIntegration"
             Title="Context Menu Integration"
             Description="Right-click menu for files and folders"
             Level="1">
      <ComponentGroupRef Id="ContextMenus" />
    </Feature>

    <ui:WixUI Id="WixUI_FeatureTree" />
    <!-- License.rtf is auto-generated from ../LICENSE during build -->
    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />

    <SetProperty Id="ARPINSTALLLOCATION" Value="[INSTALLFOLDER]" After="CostFinalize" />
    <Property Id="ARPHELPLINK" Value="https://github.com/SaltSpectre/FileUnblocker" />
    <Property Id="ARPURLINFOABOUT" Value="https://github.com/SaltSpectre/FileUnblocker" />
    <Property Id="ARPNOMODIFY" Value="1" />

  </Package>

</Wix>
